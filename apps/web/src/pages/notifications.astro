---
import BaseLayout from "@layouts/BaseLayout.astro";
import { NotificationPermissions } from "@components/NotificationPermissions";
import { AuthGuard } from "@components/AuthGuard";
import { getNotificationSnapshot } from "@stores/notifications";

const _notifications = getNotificationSnapshot();
---

<BaseLayout title="Notifications">
  <AuthGuard client:load>
    <section class="rounded-3xl border border-white/10 bg-slate-900/60 p-6">
    <header class="flex items-center justify-between">
      <div>
        <h1 class="text-xl font-semibold text-white">Notifications</h1>
        <p class="text-sm text-slate-400">Live updates from followers, likes, and comments.</p>
      </div>
      <span class="rounded-full bg-brand-500/20 px-3 py-1 text-xs font-semibold text-brand-100">
        {_notifications.filter((notif) => !notif.read).length} unread
      </span>
    </header>
    <ul class="mt-6 space-y-3 text-sm text-slate-200">
      {_notifications.map((notif) => (
        <li
          key={notif.id}
          class={`flex items-center justify-between rounded-2xl border border-white/10 px-4 py-3 ${
            notif.read ? "bg-slate-900/50" : "bg-brand-500/10"
          }`}
        >
          <div>
            <p class="font-semibold text-white">{notif.actor}</p>
            <p class="text-slate-300">{notif.message}</p>
          </div>
          <span class="text-xs text-slate-500">{new Date(notif.createdAt).toLocaleTimeString()}</span>
        </li>
      ))}
    </ul>
  </section>

  <NotificationPermissions client:load />
  </AuthGuard>
</BaseLayout>
