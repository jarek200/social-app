---
import { AuthGuard } from "@components/AuthGuard";
import { PostDetail } from "@components/PostDetail";
import BaseLayout from "@layouts/BaseLayout.astro";

// Only generate static paths in demo mode
export async function getStaticPaths() {
  if (import.meta.env.PUBLIC_DEMO_MODE === "true" || !import.meta.env.PUBLIC_APPSYNC_URL) {
    const { getFeedSnapshot } = await import("@stores/feed");
    return getFeedSnapshot().map((item) => ({
      params: { id: item.id },
      props: { postId: item.id, isDemoMode: true },
    }));
  }
  // In production, return empty array
  return [];
}

const { id: postId } = Astro.params;
---

<BaseLayout title="Post">
  <AuthGuard client:load>
    <PostDetail postId={postId} client:load />
  </AuthGuard>
</BaseLayout>
