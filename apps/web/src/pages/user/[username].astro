---
import { AuthGuard } from "@components/AuthGuard";
import { UserProfile } from "@components/UserProfile";
import BaseLayout from "@layouts/BaseLayout.astro";

// Only generate static paths in demo mode
export async function getStaticPaths() {
  if (import.meta.env.PUBLIC_DEMO_MODE === "true" || !import.meta.env.PUBLIC_APPSYNC_URL) {
    const { listUsers } = await import("@stores/users");
    return listUsers().map((user) => ({
      params: { username: user.username },
      props: { username: user.username },
    }));
  }
  // In production, return empty array (will be SSR or client-side rendered)
  return [];
}

const { username } = Astro.params;
---

<BaseLayout title={`@${username} profile`}>
  <AuthGuard client:load>
    <UserProfile username={username} client:load />
  </AuthGuard>
</BaseLayout>
