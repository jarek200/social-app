---
import { getRealtimeMetrics } from "@services/analyticsService";

const realtimeMetrics = getRealtimeMetrics();

const _sections = [
  {
    title: "Realtime Signals",
    metrics: [
      {
        label: "Active viewers",
        value: realtimeMetrics.activeViewers.toLocaleString(),
        delta: "+12%",
      },
      {
        label: "Live subscriptions",
        value: realtimeMetrics.liveSubscriptions.toLocaleString(),
        delta: "+4%",
      },
    ],
  },
  {
    title: "Workflow Status",
    metrics: [
      {
        label: "Pending moderation",
        value: realtimeMetrics.pendingModeration.toString(),
        delta: "2m avg",
      },
      {
        label: "Step Fn throughput",
        value: `${realtimeMetrics.stepFnThroughput}/min`,
        delta: "+8%",
      },
    ],
  },
];
---

<aside class="grid gap-6" id="analytics">
  {_sections.map((section: any) => (
    <section class="rounded-2xl border border-white/10 bg-slate-900/50 p-6">
      <h2 class="text-sm font-semibold uppercase tracking-wide text-slate-400">{section.title}</h2>
      <ul class="mt-4 space-y-4">
        {section.metrics.map((metric: any) => (
          <li class="flex items-center justify-between">
            <div>
              <p class="text-sm text-slate-400">{metric.label}</p>
              <p class="text-2xl font-bold text-white">{metric.value}</p>
            </div>
            <span class="text-xs font-semibold text-emerald-300">{metric.delta}</span>
          </li>
        ))}
      </ul>
    </section>
  ))}

  <section class="rounded-2xl border border-white/10 bg-slate-900/50 p-6">
    <h2 class="text-sm font-semibold uppercase tracking-wide text-slate-400">Queues</h2>
    <ul class="mt-4 space-y-3 text-sm text-slate-300">
      <li class="flex items-center justify-between">
        <span>Moderation queue</span>
        <span class="rounded-full bg-amber-500/20 px-3 py-1 text-xs font-semibold text-amber-200">5 pending</span>
      </li>
      <li class="flex items-center justify-between">
        <span>Follower fan-out</span>
        <span class="rounded-full bg-emerald-500/20 px-3 py-1 text-xs font-semibold text-emerald-200">Nominal</span>
      </li>
      <li class="flex items-center justify-between">
        <span>Notification retries</span>
        <span class="rounded-full bg-rose-500/20 px-3 py-1 text-xs font-semibold text-rose-200">2</span>
      </li>
    </ul>
  </section>
</aside>
